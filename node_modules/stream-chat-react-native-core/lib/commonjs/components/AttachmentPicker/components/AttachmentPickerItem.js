var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.renderAttachmentPickerItem = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _react = _interopRequireDefault(require("react"));
var _reactNative = require("react-native");
var _bottomSheet = require("@gorhom/bottom-sheet");
var _dayjs = _interopRequireDefault(require("dayjs"));
var _mimeTypes = require("mime-types");
var _ThemeContext = require("../../../contexts/themeContext/ThemeContext");
var _icons = require("../../../icons");
var _utils = require("../../../utils/utils");
var _this = this,
  _jsxFileName = "/home/runner/work/stream-chat-react-native/stream-chat-react-native/package/src/components/AttachmentPicker/components/AttachmentPickerItem.tsx";
var AttachmentVideo = function AttachmentVideo(props) {
  var asset = props.asset,
    ImageOverlaySelectedComponent = props.ImageOverlaySelectedComponent,
    maxNumberOfFiles = props.maxNumberOfFiles,
    numberOfAttachmentPickerImageColumns = props.numberOfAttachmentPickerImageColumns,
    numberOfUploads = props.numberOfUploads,
    selected = props.selected,
    setSelectedFiles = props.setSelectedFiles;
  var _useTheme = (0, _ThemeContext.useTheme)(),
    _useTheme$theme = _useTheme.theme,
    _useTheme$theme$attac = _useTheme$theme.attachmentPicker,
    durationText = _useTheme$theme$attac.durationText,
    image = _useTheme$theme$attac.image,
    imageOverlay = _useTheme$theme$attac.imageOverlay,
    _useTheme$theme$color = _useTheme$theme.colors,
    overlay = _useTheme$theme$color.overlay,
    white = _useTheme$theme$color.white;
  var videoDuration = asset.duration,
    uri = asset.uri;
  var ONE_HOUR_IN_SECONDS = 3600;
  var durationLabel = '00:00';
  if (videoDuration) {
    var isDurationLongerThanHour = videoDuration / ONE_HOUR_IN_SECONDS >= 1;
    var formattedDurationParam = isDurationLongerThanHour ? 'HH:mm:ss' : 'mm:ss';
    var formattedVideoDuration = _dayjs["default"].duration(videoDuration, 'second').format(formattedDurationParam);
    durationLabel = formattedVideoDuration;
  }
  var size = (0, _utils.vw)(100) / (numberOfAttachmentPickerImageColumns || 3) - 2;
  var onPressVideo = function onPressVideo() {
    if (selected) {
      setSelectedFiles(function (files) {
        return files.filter(function (file) {
          return file.uri !== asset.uri;
        });
      });
    } else {
      setSelectedFiles(function (files) {
        if (numberOfUploads >= maxNumberOfFiles) {
          _reactNative.Alert.alert('Maximum number of files reached');
          return files;
        }
        var mimeType = (0, _mimeTypes.lookup)(asset.filename) || 'multipart/form-data';
        return [].concat((0, _toConsumableArray2["default"])(files), [{
          duration: durationLabel,
          id: asset.id,
          mimeType: mimeType,
          name: asset.filename,
          size: asset.fileSize,
          uri: asset.uri
        }]);
      });
    }
  };
  return _react["default"].createElement(_bottomSheet.TouchableOpacity, {
    onPress: onPressVideo,
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 91,
      columnNumber: 5
    }
  }, _react["default"].createElement(_reactNative.ImageBackground, {
    source: {
      uri: uri
    },
    style: [{
      height: size,
      margin: 1,
      width: size
    }, image],
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 92,
      columnNumber: 7
    }
  }, selected && _react["default"].createElement(_reactNative.View, {
    style: [styles.overlay, {
      backgroundColor: overlay
    }, imageOverlay],
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 104,
      columnNumber: 11
    }
  }, _react["default"].createElement(ImageOverlaySelectedComponent, {
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 105,
      columnNumber: 13
    }
  })), _react["default"].createElement(_reactNative.View, {
    style: styles.videoView,
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 108,
      columnNumber: 9
    }
  }, _react["default"].createElement(_icons.Recorder, {
    height: 20,
    pathFill: white,
    width: 25,
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 109,
      columnNumber: 11
    }
  }), videoDuration ? _react["default"].createElement(_reactNative.Text, {
    style: [styles.durationText, durationText, {
      color: white
    }],
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 111,
      columnNumber: 13
    }
  }, durationLabel) : null)));
};
var AttachmentImage = function AttachmentImage(props) {
  var asset = props.asset,
    ImageOverlaySelectedComponent = props.ImageOverlaySelectedComponent,
    maxNumberOfFiles = props.maxNumberOfFiles,
    numberOfAttachmentPickerImageColumns = props.numberOfAttachmentPickerImageColumns,
    numberOfUploads = props.numberOfUploads,
    selected = props.selected,
    setSelectedImages = props.setSelectedImages;
  var _useTheme2 = (0, _ThemeContext.useTheme)(),
    _useTheme2$theme = _useTheme2.theme,
    _useTheme2$theme$atta = _useTheme2$theme.attachmentPicker,
    image = _useTheme2$theme$atta.image,
    imageOverlay = _useTheme2$theme$atta.imageOverlay,
    overlay = _useTheme2$theme.colors.overlay;
  var size = (0, _utils.vw)(100) / (numberOfAttachmentPickerImageColumns || 3) - 2;
  var uri = asset.uri;
  var onPressImage = function onPressImage() {
    if (selected) {
      setSelectedImages(function (images) {
        return images.filter(function (image) {
          return image.uri !== asset.uri;
        });
      });
    } else {
      setSelectedImages(function (images) {
        if (numberOfUploads >= maxNumberOfFiles) {
          _reactNative.Alert.alert('Maximum number of files reached');
          return images;
        }
        return [].concat((0, _toConsumableArray2["default"])(images), [asset]);
      });
    }
  };
  return _react["default"].createElement(_bottomSheet.TouchableOpacity, {
    onPress: onPressImage,
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 157,
      columnNumber: 5
    }
  }, _react["default"].createElement(_reactNative.ImageBackground, {
    source: {
      uri: uri
    },
    style: [{
      height: size,
      margin: 1,
      width: size
    }, image],
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 158,
      columnNumber: 7
    }
  }, selected && _react["default"].createElement(_reactNative.View, {
    style: [styles.overlay, {
      backgroundColor: overlay
    }, imageOverlay],
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 170,
      columnNumber: 11
    }
  }, _react["default"].createElement(ImageOverlaySelectedComponent, {
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 171,
      columnNumber: 13
    }
  }))));
};
var renderAttachmentPickerItem = function renderAttachmentPickerItem(_ref) {
  var item = _ref.item;
  var asset = item.asset,
    ImageOverlaySelectedComponent = item.ImageOverlaySelectedComponent,
    maxNumberOfFiles = item.maxNumberOfFiles,
    numberOfAttachmentPickerImageColumns = item.numberOfAttachmentPickerImageColumns,
    numberOfUploads = item.numberOfUploads,
    selected = item.selected,
    setSelectedFiles = item.setSelectedFiles,
    setSelectedImages = item.setSelectedImages;
  var isVideoType = asset.type.includes('video');
  if (isVideoType) {
    return _react["default"].createElement(AttachmentVideo, {
      asset: asset,
      ImageOverlaySelectedComponent: ImageOverlaySelectedComponent,
      maxNumberOfFiles: maxNumberOfFiles,
      numberOfAttachmentPickerImageColumns: numberOfAttachmentPickerImageColumns,
      numberOfUploads: numberOfUploads,
      selected: selected,
      setSelectedFiles: setSelectedFiles,
      __self: _this,
      __source: {
        fileName: _jsxFileName,
        lineNumber: 201,
        columnNumber: 7
      }
    });
  }
  return _react["default"].createElement(AttachmentImage, {
    asset: asset,
    ImageOverlaySelectedComponent: ImageOverlaySelectedComponent,
    maxNumberOfFiles: maxNumberOfFiles,
    numberOfAttachmentPickerImageColumns: numberOfAttachmentPickerImageColumns,
    numberOfUploads: numberOfUploads,
    selected: selected,
    setSelectedImages: setSelectedImages,
    __self: _this,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 214,
      columnNumber: 5
    }
  });
};
exports.renderAttachmentPickerItem = renderAttachmentPickerItem;
var styles = _reactNative.StyleSheet.create({
  durationText: {
    fontWeight: 'bold'
  },
  overlay: {
    alignItems: 'flex-end',
    flex: 1
  },
  videoView: {
    bottom: 5,
    display: 'flex',
    flexDirection: 'row',
    justifyContent: 'space-between',
    paddingHorizontal: 5,
    position: 'absolute',
    width: '100%'
  }
});
//# sourceMappingURL=AttachmentPickerItem.js.map