{"version":3,"names":["_react","require","_ChatContext","_TranslationContext","getMessageSenderName","message","currentUserId","t","membersLength","_message$user","user","id","_message$user2","_message$user3","_message$user4","name","username","getMentionUsers","mentionedUser","Array","isArray","mentionUserString","reduce","acc","cur","userName","length","getLatestMessageDisplayText","channel","client","_message$attachments","bold","text","isMessageTypeDeleted","type","userID","members","Object","keys","state","messageSender","messageSenderText","boldOwner","includes","shortenedText","substring","replace","mentionedUsers","mentioned_users","regEx","RegExp","concat","_toConsumableArray2","split","index","test","push","command","attachments","getLatestMessageDisplayDate","tDateTimeParser","parserOutput","created_at","isDayOrMoment","isSame","Date","format","MessageReadStatus","exports","getLatestMessageReadStatus","readEvents","_message$user5","NOT_SENT_BY_CURRENT_USER","readList","read","messageUpdatedAt","updated_at","undefined","values","some","_ref","last_read","READ","UNREAD","getLatestMessagePreview","params","lastMessage","messages","messageObject","previews","status","channelStateLastMessage","useLatestMessagePreview","forceUpdate","_useChatContext","useChatContext","_useTranslationContex","useTranslationContext","channelConfigExists","getConfig","channelLastMessageString","_useState","useState","_useState2","_slicedToArray2","setReadEvents","_useState3","_useState4","latestMessagePreview","setLatestMessagePreview","readStatus","useEffect","_channel$getConfig","read_events"],"sources":["useLatestMessagePreview.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nimport type { Channel, ChannelState, MessageResponse, StreamChat, UserResponse } from 'stream-chat';\n\nimport { useChatContext } from '../../../contexts/chatContext/ChatContext';\nimport {\n  isDayOrMoment,\n  TDateTimeParser,\n  useTranslationContext,\n} from '../../../contexts/translationContext/TranslationContext';\n\nimport type { DefaultStreamChatGenerics } from '../../../types/types';\n\ntype LatestMessage<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> =\n  | ReturnType<ChannelState<StreamChatGenerics>['formatMessage']>\n  | MessageResponse<StreamChatGenerics>;\n\nexport type LatestMessagePreview<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = {\n  created_at: string | number | Date;\n  messageObject: LatestMessage<StreamChatGenerics> | undefined;\n  previews: {\n    bold: boolean;\n    text: string;\n  }[];\n  status: number;\n};\n\nconst getMessageSenderName = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  message: LatestMessage<StreamChatGenerics> | undefined,\n  currentUserId: string | undefined,\n  t: (key: string) => string,\n  membersLength: number,\n) => {\n  if (message?.user?.id === currentUserId) {\n    return t('You');\n  }\n\n  if (membersLength > 2) {\n    return message?.user?.name || message?.user?.username || message?.user?.id || '';\n  }\n\n  return '';\n};\n\nconst getMentionUsers = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  mentionedUser: UserResponse<StreamChatGenerics>[] | undefined,\n) => {\n  if (Array.isArray(mentionedUser)) {\n    const mentionUserString = mentionedUser.reduce((acc, cur) => {\n      const userName = cur.name || cur.id || '';\n      if (userName) {\n        acc += `${acc.length ? '|' : ''}@${userName}`;\n      }\n      return acc;\n    }, '');\n    return mentionUserString;\n  }\n  return '';\n};\n\nconst getLatestMessageDisplayText = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  channel: Channel<StreamChatGenerics>,\n  client: StreamChat<StreamChatGenerics>,\n  message: LatestMessage<StreamChatGenerics> | undefined,\n  t: (key: string) => string,\n) => {\n  if (!message) return [{ bold: false, text: t('Nothing yet...') }];\n  const isMessageTypeDeleted = message.type === 'deleted';\n  if (isMessageTypeDeleted) return [{ bold: false, text: t('Message deleted') }];\n  const currentUserId = client?.userID;\n  const members = Object.keys(channel.state.members);\n\n  const messageSender = getMessageSenderName(message, currentUserId, t, members.length);\n  const messageSenderText = messageSender\n    ? `${messageSender === t('You') ? '' : '@'}${messageSender}: `\n    : '';\n  const boldOwner = messageSenderText.includes('@');\n  if (message.text) {\n    // rough guess optimization to limit string preview to max 100 characters\n    const shortenedText = message.text.substring(0, 100).replace(/\\n/g, ' ');\n    const mentionedUsers = getMentionUsers(message.mentioned_users);\n    const regEx = new RegExp(`^(${mentionedUsers})`);\n    return [\n      { bold: boldOwner, text: messageSenderText },\n      ...shortenedText.split('').reduce(\n        (acc, cur, index) => {\n          if (cur === '@' && mentionedUsers && regEx.test(shortenedText.substring(index))) {\n            acc.push({ bold: true, text: cur });\n          } else if (mentionedUsers && regEx.test(acc[acc.length - 1].text)) {\n            acc.push({ bold: false, text: cur });\n          } else {\n            acc[acc.length - 1].text += cur;\n          }\n          return acc;\n        },\n        [{ bold: false, text: '' }],\n      ),\n    ];\n  }\n  if (message.command) {\n    return [\n      { bold: boldOwner, text: messageSenderText },\n      { bold: false, text: `/${message.command}` },\n    ];\n  }\n  if (message.attachments?.length) {\n    return [\n      { bold: boldOwner, text: messageSenderText },\n      { bold: false, text: t('üèô Attachment...') },\n    ];\n  }\n  return [\n    { bold: boldOwner, text: messageSenderText },\n    { bold: false, text: t('Empty message...') },\n  ];\n};\n\nconst getLatestMessageDisplayDate = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  message: LatestMessage<StreamChatGenerics> | undefined,\n  tDateTimeParser: TDateTimeParser,\n) => {\n  const parserOutput = tDateTimeParser(message?.created_at);\n  if (isDayOrMoment(parserOutput)) {\n    if (parserOutput.isSame(new Date(), 'day')) {\n      return parserOutput.format('LT');\n    }\n    return parserOutput.format('L');\n  }\n  return parserOutput;\n};\n\nexport enum MessageReadStatus {\n  NOT_SENT_BY_CURRENT_USER = 0,\n  UNREAD = 1,\n  READ = 2,\n}\n\nconst getLatestMessageReadStatus = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  channel: Channel<StreamChatGenerics>,\n  client: StreamChat<StreamChatGenerics>,\n  message: LatestMessage<StreamChatGenerics> | undefined,\n  readEvents: boolean,\n): MessageReadStatus => {\n  const currentUserId = client.userID;\n  if (!message || currentUserId !== message.user?.id || readEvents === false) {\n    return MessageReadStatus.NOT_SENT_BY_CURRENT_USER;\n  }\n\n  const readList = channel.state.read;\n  if (currentUserId) {\n    delete readList[currentUserId];\n  }\n\n  const messageUpdatedAt = message.updated_at\n    ? typeof message.updated_at === 'string'\n      ? new Date(message.updated_at)\n      : message.updated_at\n    : undefined;\n\n  return Object.values(readList).some(\n    ({ last_read }) => messageUpdatedAt && messageUpdatedAt < last_read,\n  )\n    ? MessageReadStatus.READ\n    : MessageReadStatus.UNREAD;\n};\n\nconst getLatestMessagePreview = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(params: {\n  channel: Channel<StreamChatGenerics>;\n  client: StreamChat<StreamChatGenerics>;\n  readEvents: boolean;\n  t: (key: string) => string;\n  tDateTimeParser: TDateTimeParser;\n  lastMessage?:\n    | ReturnType<ChannelState<StreamChatGenerics>['formatMessage']>\n    | MessageResponse<StreamChatGenerics>;\n}) => {\n  const { channel, client, lastMessage, readEvents, t, tDateTimeParser } = params;\n\n  const messages = channel.state.messages;\n\n  if (!messages.length && !lastMessage) {\n    return {\n      created_at: '',\n      messageObject: undefined,\n      previews: [\n        {\n          bold: false,\n          text: t('Nothing yet...'),\n        },\n      ],\n      status: MessageReadStatus.NOT_SENT_BY_CURRENT_USER,\n    };\n  }\n\n  const channelStateLastMessage = messages.length ? messages[messages.length - 1] : undefined;\n\n  const message = lastMessage !== undefined ? lastMessage : channelStateLastMessage;\n\n  return {\n    created_at: getLatestMessageDisplayDate(message, tDateTimeParser),\n    messageObject: message,\n    previews: getLatestMessageDisplayText(channel, client, message, t),\n    status: getLatestMessageReadStatus(channel, client, message, readEvents),\n  };\n};\n\n/**\n * Hook to set the display preview for latest message on channel.\n *\n * @param {*} channel Channel object\n *\n * @returns {object} latest message preview e.g.. { text: 'this was last message ...', created_at: '11/12/2020', messageObject: { originalMessageObject } }\n */\nexport const useLatestMessagePreview = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  channel: Channel<StreamChatGenerics>,\n  forceUpdate: number,\n  lastMessage?:\n    | ReturnType<ChannelState<StreamChatGenerics>['formatMessage']>\n    | MessageResponse<StreamChatGenerics>,\n) => {\n  const { client } = useChatContext<StreamChatGenerics>();\n  const { t, tDateTimeParser } = useTranslationContext();\n\n  const channelConfigExists = typeof channel?.getConfig === 'function';\n\n  const messages = channel.state.messages;\n  const message = messages.length ? messages[messages.length - 1] : undefined;\n\n  const channelLastMessageString = `${lastMessage?.id || message?.id}${\n    lastMessage?.updated_at || message?.updated_at\n  }`;\n\n  const [readEvents, setReadEvents] = useState(true);\n  const [latestMessagePreview, setLatestMessagePreview] = useState<\n    LatestMessagePreview<StreamChatGenerics>\n  >({\n    created_at: '',\n    messageObject: undefined,\n    previews: [\n      {\n        bold: false,\n        text: '',\n      },\n    ],\n    status: MessageReadStatus.NOT_SENT_BY_CURRENT_USER,\n  });\n\n  const readStatus = getLatestMessageReadStatus(\n    channel,\n    client,\n    lastMessage || message,\n    readEvents,\n  );\n\n  useEffect(() => {\n    if (channelConfigExists) {\n      const read_events = channel.getConfig()?.read_events;\n      if (typeof read_events === 'boolean') {\n        setReadEvents(read_events);\n      }\n    }\n  }, [channelConfigExists]);\n\n  useEffect(\n    () =>\n      setLatestMessagePreview(\n        getLatestMessagePreview({\n          channel,\n          client,\n          lastMessage,\n          readEvents,\n          t,\n          tDateTimeParser,\n        }),\n      ),\n    [channelLastMessageString, forceUpdate, readEvents, readStatus],\n  );\n\n  return latestMessagePreview;\n};\n"],"mappings":"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"}